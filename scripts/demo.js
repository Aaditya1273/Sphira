#!/usr/bin/env node

/**
 * Sphira DeFi Platform Demo Script
 *
 * This script demonstrates the key features of the Sphira platform:
 * 1. Portfolio overview
 * 2. SIP creation and management
 * 3. Yield optimization
 * 4. Chat commands
 * 5. Emergency fund locking
 */

const { ethers } = require("ethers")
const readline = require("readline")

// Demo configuration
const DEMO_CONFIG = {
  rpcUrl: "https://testnet-rpc.somnia.network",
  chainId: 2648,
  contracts: {
    sipManager: "0x1234567890123456789012345678901234567890",
    yieldRouter: "0x2345678901234567890123456789012345678901",
    lockVault: "0x3456789012345678901234567890123456789012",
  },
  tokens: {
    USDC: "0x4567890123456789012345678901234567890123",
    ETH: "0x5678901234567890123456789012345678901234",
    SOM: "0x6789012345678901234567890123456789012345",
  },
}

class SphiraDemo {
  constructor() {
    this.rl = readline.createInterface({
      input: process.stdin,
      output: process.stdout,
    })

    this.provider = new ethers.JsonRpcProvider(DEMO_CONFIG.rpcUrl)
    this.wallet = null
    this.contracts = {}

    this.demoData = {
      portfolio: {
        totalValue: "10000.00",
        totalDeposited: "9500.00",
        totalYield: "500.00",
        yieldPercentage: 5.26,
        activeSips: 3,
        lockedFunds: "2000.00",
      },
      sips: [
        {
          id: "sip_001",
          amount: "100.00",
          token: "USDC",
          frequency: "weekly",
          status: "active",
          nextExecution: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
          totalDeposited: "400.00",
        },
        {
          id: "sip_002",
          amount: "50.00",
          token: "ETH",
          frequency: "monthly",
          status: "active",
          nextExecution: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),
          totalDeposited: "200.00",
        },
      ],
      yieldPools: [
        {
          name: "USDC-SOM LP",
          protocol: "SomniaSwap",
          apy: 15.5,
          allocation: "40%",
          value: "4000.00",
        },
        {
          name: "ETH Staking",
          protocol: "Somnia Staking",
          apy: 8.2,
          allocation: "30%",
          value: "3000.00",
        },
        {
          name: "USDC Lending",
          protocol: "Somnia Lend",
          apy: 6.8,
          allocation: "30%",
          value: "3000.00",
        },
      ],
    }
  }

  async start() {
    console.log("\nüöÄ Welcome to Sphira DeFi Platform Demo!")
    console.log("=====================================\n")

    await this.showMainMenu()
  }

  async showMainMenu() {
    console.log("üìã Main Menu:")
    console.log("1. Portfolio Overview")
    console.log("2. SIP Management")
    console.log("3. Yield Optimization")
    console.log("4. Chat Commands Demo")
    console.log("5. Emergency Fund Lock")
    console.log("6. Analytics Dashboard")
    console.log("7. Exit\n")

    const choice = await this.askQuestion("Select an option (1-7): ")

    switch (choice) {
      case "1":
        await this.showPortfolioOverview()
        break
      case "2":
        await this.showSIPManagement()
        break
      case "3":
        await this.showYieldOptimization()
        break
      case "4":
        await this.showChatCommands()
        break
      case "5":
        await this.showEmergencyFundLock()
        break
      case "6":
        await this.showAnalytics()
        break
      case "7":
        console.log("\nüëã Thank you for trying Sphira! Visit https://sphira.finance for more info.\n")
        this.rl.close()
        return
      default:
        console.log("‚ùå Invalid option. Please try again.\n")
        await this.showMainMenu()
    }
  }

  async showPortfolioOverview() {
    console.log("\nüíº Portfolio Overview")
    console.log("====================\n")

    const { portfolio } = this.demoData

    console.log(`üìä Total Portfolio Value: $${portfolio.totalValue}`)
    console.log(`üí∞ Total Deposited: $${portfolio.totalDeposited}`)
    console.log(`üìà Total Yield Earned: $${portfolio.totalYield} (${portfolio.yieldPercentage}%)`)
    console.log(`üîÑ Active SIPs: ${portfolio.activeSips}`)
    console.log(`üîí Locked Funds: $${portfolio.lockedFunds}\n`)

    console.log("üíé Token Breakdown:")
    console.log("‚îú‚îÄ‚îÄ USDC: $5,000.00 (50%)")
    console.log("‚îú‚îÄ‚îÄ ETH: $3,000.00 (30%)")
    console.log("‚îî‚îÄ‚îÄ SOM: $2,000.00 (20%)\n")

    console.log("üìà Performance (Last 30 Days):")
    console.log("‚îú‚îÄ‚îÄ Best Day: +$125.50 (Jan 15)")
    console.log("‚îú‚îÄ‚îÄ Worst Day: -$45.20 (Jan 8)")
    console.log("‚îî‚îÄ‚îÄ Average Daily: +$16.67\n")

    await this.askQuestion("Press Enter to continue...")
    await this.showMainMenu()
  }

  async showSIPManagement() {
    console.log("\nüîÑ SIP Management")
    console.log("=================\n")

    console.log("üìã Active SIPs:")
    this.demoData.sips.forEach((sip, index) => {
      console.log(`${index + 1}. ${sip.amount} ${sip.token} - ${sip.frequency}`)
      console.log(`   Status: ${sip.status}`)
      console.log(`   Next: ${sip.nextExecution.toLocaleDateString()}`)
      console.log(`   Total Deposited: $${sip.totalDeposited}\n`)
    })

    console.log("üõ†Ô∏è SIP Actions:")
    console.log("1. Create New SIP")
    console.log("2. Modify Existing SIP")
    console.log("3. Cancel SIP")
    console.log("4. Back to Main Menu\n")

    const choice = await this.askQuestion("Select action (1-4): ")

    switch (choice) {
      case "1":
        await this.createNewSIP()
        break
      case "2":
        await this.modifySIP()
        break
      case "3":
        await this.cancelSIP()
        break
      case "4":
        await this.showMainMenu()
        break
      default:
        console.log("‚ùå Invalid option.\n")
        await this.showSIPManagement()
    }
  }

  async createNewSIP() {
    console.log("\n‚ú® Create New SIP")
    console.log("==================\n")

    const amount = await this.askQuestion("Enter amount: $")
    const token = await this.askQuestion("Enter token (USDC/ETH/SOM): ")
    const frequency = await this.askQuestion("Enter frequency (daily/weekly/monthly): ")
    const duration = await this.askQuestion("Enter duration (number of periods): ")

    console.log("\nüìã SIP Summary:")
    console.log(`Amount: $${amount} ${token}`)
    console.log(`Frequency: ${frequency}`)
    console.log(`Duration: ${duration} periods`)
    console.log(`Total Investment: $${Number.parseFloat(amount) * Number.parseInt(duration)}\n`)

    const confirm = await this.askQuestion("Confirm creation? (y/n): ")

    if (confirm.toLowerCase() === "y") {
      console.log("\n‚è≥ Creating SIP...")
      await this.simulateTransaction()
      console.log("‚úÖ SIP created successfully!")
      console.log(`üìÑ Transaction Hash: 0x${Math.random().toString(16).substr(2, 64)}`)
      console.log(`üÜî SIP ID: sip_${Math.random().toString(36).substr(2, 9)}\n`)
    } else {
      console.log("‚ùå SIP creation cancelled.\n")
    }

    await this.askQuestion("Press Enter to continue...")
    await this.showSIPManagement()
  }

  async modifySIP() {
    console.log("\n‚úèÔ∏è Modify SIP")
    console.log("==============\n")

    console.log("Select SIP to modify:")
    this.demoData.sips.forEach((sip, index) => {
      console.log(`${index + 1}. ${sip.amount} ${sip.token} - ${sip.frequency}`)
    })

    const sipIndex = await this.askQuestion("\nSelect SIP (1-2): ")
    const selectedSip = this.demoData.sips[Number.parseInt(sipIndex) - 1]

    if (!selectedSip) {
      console.log("‚ùå Invalid SIP selection.\n")
      await this.showSIPManagement()
      return
    }

    console.log(`\nüìù Modifying SIP: ${selectedSip.id}`)
    console.log("What would you like to change?")
    console.log("1. Amount")
    console.log("2. Frequency")
    console.log("3. Both\n")

    const changeType = await this.askQuestion("Select option (1-3): ")

    if (changeType === "1" || changeType === "3") {
      const newAmount = await this.askQuestion(`New amount (current: $${selectedSip.amount}): $`)
      selectedSip.amount = newAmount
    }

    if (changeType === "2" || changeType === "3") {
      const newFrequency = await this.askQuestion(`New frequency (current: ${selectedSip.frequency}): `)
      selectedSip.frequency = newFrequency
    }

    console.log("\n‚è≥ Updating SIP...")
    await this.simulateTransaction()
    console.log("‚úÖ SIP updated successfully!\n")

    await this.askQuestion("Press Enter to continue...")
    await this.showSIPManagement()
  }

  async cancelSIP() {
    console.log("\nüóëÔ∏è Cancel SIP")
    console.log("==============\n")

    console.log("Select SIP to cancel:")
    this.demoData.sips.forEach((sip, index) => {
      console.log(`${index + 1}. ${sip.amount} ${sip.token} - ${sip.frequency}`)
    })

    const sipIndex = await this.askQuestion("\nSelect SIP (1-2): ")
    const selectedSip = this.demoData.sips[Number.parseInt(sipIndex) - 1]

    if (!selectedSip) {
      console.log("‚ùå Invalid SIP selection.\n")
      await this.showSIPManagement()
      return
    }

    console.log(`\n‚ö†Ô∏è Warning: Cancelling SIP ${selectedSip.id}`)
    console.log("This action cannot be undone.")

    const confirm = await this.askQuestion("Are you sure? (y/n): ")

    if (confirm.toLowerCase() === "y") {
      console.log("\n‚è≥ Cancelling SIP...")
      await this.simulateTransaction()
      selectedSip.status = "cancelled"
      console.log("‚úÖ SIP cancelled successfully!\n")
    } else {
      console.log("‚ùå Cancellation aborted.\n")
    }

    await this.askQuestion("Press Enter to continue...")
    await this.showSIPManagement()
  }

  async showYieldOptimization() {
    console.log("\nüìà Yield Optimization")
    console.log("=====================\n")

    console.log("üéØ Current Yield Strategy: Balanced")
    console.log("üìä Average APY: 12.8%")
    console.log("üîÑ Last Rebalance: 2 hours ago\n")

    console.log("üí∞ Pool Allocations:")
    this.demoData.yieldPools.forEach((pool, index) => {
      console.log(`${index + 1}. ${pool.name} (${pool.protocol})`)
      console.log(`   APY: ${pool.apy}% | Allocation: ${pool.allocation} | Value: $${pool.value}`)
      console.log("")
    })

    console.log("üîß Optimization Actions:")
    console.log("1. Rebalance Now")
    console.log("2. Change Strategy")
    console.log("3. View Pool Details")
    console.log("4. Back to Main Menu\n")

    const choice = await this.askQuestion("Select action (1-4): ")

    switch (choice) {
      case "1":
        await this.rebalancePortfolio()
        break
      case "2":
        await this.changeStrategy()
        break
      case "3":
        await this.viewPoolDetails()
        break
      case "4":
        await this.showMainMenu()
        break
      default:
        console.log("‚ùå Invalid option.\n")
        await this.showYieldOptimization()
    }
  }

  async rebalancePortfolio() {
    console.log("\n‚öñÔ∏è Portfolio Rebalancing")
    console.log("========================\n")

    console.log("üîç Analyzing current market conditions...")
    await this.simulateDelay(2000)

    console.log("üìä Optimization opportunities found:")
    console.log("‚îú‚îÄ‚îÄ Move 5% from USDC Lending (6.8% APY) to USDC-SOM LP (15.5% APY)")
    console.log("‚îú‚îÄ‚îÄ Increase ETH Staking allocation by 3%")
    console.log("‚îî‚îÄ‚îÄ Estimated APY improvement: +0.8%\n")

    const confirm = await this.askQuestion("Execute rebalancing? (y/n): ")

    if (confirm.toLowerCase() === "y") {
      console.log("\n‚è≥ Executing rebalancing...")
      await this.simulateTransaction()
      console.log("‚úÖ Portfolio rebalanced successfully!")
      console.log("üìà New Average APY: 13.6%\n")
    } else {
      console.log("‚ùå Rebalancing cancelled.\n")
    }

    await this.askQuestion("Press Enter to continue...")
    await this.showYieldOptimization()
  }

  async changeStrategy() {
    console.log("\nüéØ Change Yield Strategy")
    console.log("========================\n")

    console.log("Available Strategies:")
    console.log("1. Conservative (Low Risk, 6-8% APY)")
    console.log("   ‚îî‚îÄ‚îÄ 70% Stablecoins, 30% Blue-chip tokens")
    console.log("2. Balanced (Medium Risk, 10-15% APY) [CURRENT]")
    console.log("   ‚îî‚îÄ‚îÄ 50% Stablecoins, 50% Growth tokens")
    console.log("3. Aggressive (High Risk, 15-25% APY)")
    console.log("   ‚îî‚îÄ‚îÄ 30% Stablecoins, 70% High-yield pools\n")

    const strategy = await this.askQuestion("Select strategy (1-3): ")

    const strategies = ["Conservative", "Balanced", "Aggressive"]
    const selectedStrategy = strategies[Number.parseInt(strategy) - 1]

    if (selectedStrategy) {
      console.log(`\n‚è≥ Switching to ${selectedStrategy} strategy...`)
      await this.simulateTransaction()
      console.log(`‚úÖ Strategy changed to ${selectedStrategy}!\n`)
    } else {
      console.log("‚ùå Invalid strategy selection.\n")
    }

    await this.askQuestion("Press Enter to continue...")
    await this.showYieldOptimization()
  }

  async viewPoolDetails() {
    console.log("\nüèä Pool Details")
    console.log("===============\n")

    console.log("Select pool for detailed information:")
    this.demoData.yieldPools.forEach((pool, index) => {
      console.log(`${index + 1}. ${pool.name}`)
    })

    const poolIndex = await this.askQuestion("\nSelect pool (1-3): ")
    const selectedPool = this.demoData.yieldPools[Number.parseInt(poolIndex) - 1]

    if (selectedPool) {
      console.log(`\nüìä ${selectedPool.name} Details:`)
      console.log(`Protocol: ${selectedPool.protocol}`)
      console.log(`Current APY: ${selectedPool.apy}%`)
      console.log(`Your Allocation: ${selectedPool.allocation}`)
      console.log(`Your Value: $${selectedPool.value}`)
      console.log(`Total Value Locked: $2,500,000`)
      console.log(`Risk Level: Medium`)
      console.log(`Liquidity: High\n`)

      console.log("üìà 7-Day Performance:")
      console.log("‚îú‚îÄ‚îÄ Highest APY: 16.2%")
      console.log("‚îú‚îÄ‚îÄ Lowest APY: 14.8%")
      console.log("‚îî‚îÄ‚îÄ Average APY: 15.5%\n")
    } else {
      console.log("‚ùå Invalid pool selection.\n")
    }

    await this.askQuestion("Press Enter to continue...")
    await this.showYieldOptimization()
  }

  async showChatCommands() {
    console.log("\nüí¨ Chat Commands Demo")
    console.log("=====================\n")

    console.log("ü§ñ Sphira AI Assistant is ready to help!")
    console.log("Try these commands:\n")

    console.log("Available Commands:")
    console.log("‚îú‚îÄ‚îÄ /startSIP <amount> <token> <frequency>")
    console.log("‚îú‚îÄ‚îÄ /portfolio")
    console.log("‚îú‚îÄ‚îÄ /yield")
    console.log("‚îú‚îÄ‚îÄ /lockFunds <amount> <token>")
    console.log("‚îú‚îÄ‚îÄ /sips")
    console.log("‚îú‚îÄ‚îÄ /cancel <sipId>")
    console.log("‚îî‚îÄ‚îÄ /help\n")

    while (true) {
      const command = await this.askQuestion('üí¨ Enter command (or "exit" to return): ')

      if (command.toLowerCase() === "exit") {
        break
      }

      await this.processCommand(command)
    }

    await this.showMainMenu()
  }

  async processCommand(command) {
    const parts = command.split(" ")
    const cmd = parts[0].toLowerCase()

    console.log("\nü§ñ Sphira AI:")

    switch (cmd) {
      case "/startsip":
        if (parts.length >= 4) {
          const amount = parts[1]
          const token = parts[2]
          const frequency = parts[3]
          console.log(`‚úÖ SIP created! ${amount} ${token} ${frequency} for 12 weeks.`)
          console.log(`üìÖ Next execution: ${new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toLocaleDateString()}`)
          console.log(`üÜî SIP ID: sip_${Math.random().toString(36).substr(2, 9)}`)
        } else {
          console.log("‚ùå Usage: /startSIP <amount> <token> <frequency>")
          console.log("üìù Example: /startSIP 100 USDC weekly")
        }
        break

      case "/portfolio":
        console.log("üíº Portfolio Summary:")
        console.log(`‚îú‚îÄ‚îÄ Total Value: $${this.demoData.portfolio.totalValue}`)
        console.log(
          `‚îú‚îÄ‚îÄ Total Yield: $${this.demoData.portfolio.totalYield} (${this.demoData.portfolio.yieldPercentage}%)`,
        )
        console.log(`‚îú‚îÄ‚îÄ Active SIPs: ${this.demoData.portfolio.activeSips}`)
        console.log(`‚îî‚îÄ‚îÄ Locked Funds: $${this.demoData.portfolio.lockedFunds}`)
        break

      case "/yield":
        console.log("üìà Yield Information:")
        console.log("‚îú‚îÄ‚îÄ Average APY: 12.8%")
        console.log("‚îú‚îÄ‚îÄ Best Pool: USDC-SOM LP (15.5% APY)")
        console.log("‚îú‚îÄ‚îÄ Total Earned: $500.00")
        console.log("‚îî‚îÄ‚îÄ Next Rebalance: In 22 hours")
        break

      case "/lockfunds":
        if (parts.length >= 3) {
          const amount = parts[1]
          const token = parts[2]
          console.log(`üîí Emergency lock created for ${amount} ${token}`)
          console.log("üõ°Ô∏è Funds are now protected and require multi-sig approval for unlock")
          console.log(`üÜî Lock ID: lock_${Math.random().toString(36).substr(2, 9)}`)
        } else {
          console.log("‚ùå Usage: /lockFunds <amount> <token>")
          console.log("üìù Example: /lockFunds 1000 USDC")
        }
        break

      case "/sips":
        console.log("üîÑ Active SIPs:")
        this.demoData.sips.forEach((sip, index) => {
          console.log(`‚îú‚îÄ‚îÄ ${sip.id}: ${sip.amount} ${sip.token} ${sip.frequency}`)
        })
        break

      case "/help":
        console.log("üÜò Available Commands:")
        console.log("‚îú‚îÄ‚îÄ /startSIP - Create new SIP")
        console.log("‚îú‚îÄ‚îÄ /portfolio - View portfolio")
        console.log("‚îú‚îÄ‚îÄ /yield - Yield information")
        console.log("‚îú‚îÄ‚îÄ /lockFunds - Lock emergency funds")
        console.log("‚îú‚îÄ‚îÄ /sips - List all SIPs")
        console.log("‚îî‚îÄ‚îÄ /cancel - Cancel SIP")
        break

      default:
        console.log("‚ùì Unknown command. Type /help for available commands.")
    }

    console.log("")
  }

  async showEmergencyFundLock() {
    console.log("\nüîí Emergency Fund Lock")
    console.log("======================\n")

    console.log("üõ°Ô∏è Emergency Vault Status:")
    console.log(`‚îú‚îÄ‚îÄ Total Locked: $${this.demoData.portfolio.lockedFunds}`)
    console.log("‚îú‚îÄ‚îÄ Active Locks: 2")
    console.log("‚îú‚îÄ‚îÄ Multi-sig Members: 5")
    console.log("‚îî‚îÄ‚îÄ Required Signatures: 3\n")

    console.log("üìã Active Locks:")
    console.log("1. Lock #001: $1,000 USDC (Jan 15, 2025)")
    console.log("   ‚îî‚îÄ‚îÄ Condition: Emergency market crash")
    console.log("2. Lock #002: $1,000 ETH (Jan 18, 2025)")
    console.log("   ‚îî‚îÄ‚îÄ Condition: Protocol vulnerability\n")

    console.log("üîß Lock Actions:")
    console.log("1. Create New Lock")
    console.log("2. Request Emergency Unlock")
    console.log("3. View Lock Details")
    console.log("4. Back to Main Menu\n")

    const choice = await this.askQuestion("Select action (1-4): ")

    switch (choice) {
      case "1":
        await this.createEmergencyLock()
        break
      case "2":
        await this.requestEmergencyUnlock()
        break
      case "3":
        await this.viewLockDetails()
        break
      case "4":
        await this.showMainMenu()
        break
      default:
        console.log("‚ùå Invalid option.\n")
        await this.showEmergencyFundLock()
    }
  }

  async createEmergencyLock() {
    console.log("\nüîê Create Emergency Lock")
    console.log("========================\n")

    const amount = await this.askQuestion("Enter amount to lock: $")
    const token = await this.askQuestion("Enter token (USDC/ETH/SOM): ")
    const condition = await this.askQuestion("Enter unlock condition: ")

    console.log("\nüìã Lock Summary:")
    console.log(`Amount: $${amount} ${token}`)
    console.log(`Condition: ${condition}`)
    console.log("Multi-sig Required: 3/5 signatures\n")

    const confirm = await this.askQuestion("Create emergency lock? (y/n): ")

    if (confirm.toLowerCase() === "y") {
      console.log("\n‚è≥ Creating emergency lock...")
      await this.simulateTransaction()
      console.log("‚úÖ Emergency lock created successfully!")
      console.log(`üÜî Lock ID: lock_${Math.random().toString(36).substr(2, 9)}`)
      console.log("üõ°Ô∏è Funds are now protected and require multi-sig approval for unlock\n")
    } else {
      console.log("‚ùå Lock creation cancelled.\n")
    }

    await this.askQuestion("Press Enter to continue...")
    await this.showEmergencyFundLock()
  }

  async requestEmergencyUnlock() {
    console.log("\nüö® Request Emergency Unlock")
    console.log("===========================\n")

    console.log("‚ö†Ô∏è WARNING: Emergency unlocks should only be requested in genuine emergencies.")
    console.log("This action will notify all multi-sig members for approval.\n")

    console.log("Select lock to unlock:")
    console.log("1. Lock #001: $1,000 USDC")
    console.log("2. Lock #002: $1,000 ETH\n")

    const lockChoice = await this.askQuestion("Select lock (1-2): ")
    const reason = await this.askQuestion("Enter emergency reason: ")

    console.log("\nüìã Unlock Request Summary:")
    console.log(`Lock: #00${lockChoice}`)
    console.log(`Reason: ${reason}`)
    console.log("Required Approvals: 3/5\n")

    const confirm = await this.askQuestion("Submit unlock request? (y/n): ")

    if (confirm.toLowerCase() === "y") {
      console.log("\n‚è≥ Submitting unlock request...")
      await this.simulateTransaction()
      console.log("‚úÖ Emergency unlock request submitted!")
      console.log("üìß Multi-sig members have been notified")
      console.log("‚è∞ Estimated approval time: 2-24 hours\n")
    } else {
      console.log("‚ùå Unlock request cancelled.\n")
    }

    await this.askQuestion("Press Enter to continue...")
    await this.showEmergencyFundLock()
  }

  async viewLockDetails() {
    console.log("\nüîç Lock Details")
    console.log("===============\n")

    console.log("Select lock to view:")
    console.log("1. Lock #001: $1,000 USDC")
    console.log("2. Lock #002: $1,000 ETH\n")

    const lockChoice = await this.askQuestion("Select lock (1-2): ")

    console.log(`\nüìä Lock #00${lockChoice} Details:`)
    console.log(`Amount: $1,000 ${lockChoice === "1" ? "USDC" : "ETH"}`)
    console.log(`Created: Jan ${lockChoice === "1" ? "15" : "18"}, 2025`)
    console.log(`Condition: ${lockChoice === "1" ? "Emergency market crash" : "Protocol vulnerability"}`)
    console.log("Status: Active")
    console.log("Multi-sig: 3/5 required")
    console.log("Unlock Requests: 0\n")

    console.log("üîê Multi-sig Members:")
    console.log("‚îú‚îÄ‚îÄ 0x1234...5678 (Admin)")
    console.log("‚îú‚îÄ‚îÄ 0x2345...6789 (Community Rep)")
    console.log("‚îú‚îÄ‚îÄ 0x3456...7890 (Technical Lead)")
    console.log("‚îú‚îÄ‚îÄ 0x4567...8901 (Security Expert)")
    console.log("‚îî‚îÄ‚îÄ 0x5678...9012 (Community Rep)\n")

    await this.askQuestion("Press Enter to continue...")
    await this.showEmergencyFundLock()
  }

  async showAnalytics() {
    console.log("\nüìä Analytics Dashboard")
    console.log("======================\n")

    console.log("üåê Platform Statistics:")
    console.log("‚îú‚îÄ‚îÄ Total Users: 1,250")
    console.log("‚îú‚îÄ‚îÄ Total SIPs: 3,500")
    console.log("‚îú‚îÄ‚îÄ Total Value Locked: $5,000,000")
    console.log("‚îú‚îÄ‚îÄ Average Yield: 12.5%")
    console.log("‚îî‚îÄ‚îÄ Active Pools: 15\n")

    console.log("üìà Your Performance:")
    console.log("‚îú‚îÄ‚îÄ Portfolio Rank: #127 (Top 10%)")
    console.log("‚îú‚îÄ‚îÄ Best Month: +$85.50 (December 2024)")
    console.log("‚îú‚îÄ‚îÄ Consistency Score: 8.5/10")
    console.log("‚îî‚îÄ‚îÄ Risk Score: Medium\n")

    console.log("üèÜ Achievements:")
    console.log("‚îú‚îÄ‚îÄ ‚úÖ First SIP Created")
    console.log("‚îú‚îÄ‚îÄ ‚úÖ $1K Milestone")
    console.log("‚îú‚îÄ‚îÄ ‚úÖ Yield Optimizer")
    console.log("‚îú‚îÄ‚îÄ ‚è≥ Emergency Preparedness (80%)")
    console.log("‚îî‚îÄ‚îÄ ‚è≥ Diamond Hands (60%)\n")

    console.log("üìÖ Recent Activity (Last 7 Days):")
    console.log("‚îú‚îÄ‚îÄ Jan 20: SIP executed (+$100 USDC)")
    console.log("‚îú‚îÄ‚îÄ Jan 19: Yield harvested (+$12.50)")
    console.log("‚îú‚îÄ‚îÄ Jan 18: Emergency lock created")
    console.log("‚îú‚îÄ‚îÄ Jan 17: Portfolio rebalanced")
    console.log("‚îî‚îÄ‚îÄ Jan 15: New SIP created\n")

    await this.askQuestion("Press Enter to continue...")
    await this.showMainMenu()
  }

  async simulateTransaction() {
    const steps = ["Preparing transaction...", "Signing...", "Broadcasting...", "Confirming..."]

    for (const step of steps) {
      process.stdout.write(`‚è≥ ${step}`)
      await this.simulateDelay(1000)
      process.stdout.write("\r‚úÖ " + step + " Done!\n")
    }
  }

  async simulateDelay(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms))
  }

  askQuestion(question) {
    return new Promise((resolve) => {
      this.rl.question(question, (answer) => {
        resolve(answer)
      })
    })
  }
}

// Start the demo
if (require.main === module) {
  const demo = new SphiraDemo()
  demo.start().catch(console.error)
}

module.exports = SphiraDemo
